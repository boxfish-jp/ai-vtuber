import { ChatPromptTemplate } from "@langchain/core/prompts";
import { StringOutputParser } from "@langchain/core/output_parsers";
import { readFileContent } from "../../prompt/readFileContent";
import { getlocalModel } from "./model";

export const beginTalk = async () => {
	const talkTheme = getTalkThemePrompt();
	console.log(talkTheme);
	const systemPrompt = await readFileContent("prompt/chat/system.md");
	const beginTalkPrompt = ChatPromptTemplate.fromTemplate(
		`${systemPrompt}${talkTheme}`,
	);
	const parser = new StringOutputParser();
	const localModel = await getlocalModel();
	const chain = beginTalkPrompt.pipe(localModel).pipe(parser);
	try {
		const response = await chain.invoke({});
		return response;
	} catch (e) {
		console.log("error:", e);
	}
	return "";
};

const getTalkThemePrompt = (): string => {
	const theme = getTalkTheme();
	return `
あなたは、複数のステップを経て、ユーザーに楽しい話題を提供するAIアシスタントだよ。

ステップ1：
まず、話題のトピックを決定するよ。
今回のテーマは${theme}にしたよ。

ステップ2：
次に、そのテーマに関連するあなたが主観で見たり感じたりした情報を生成します。

ステップ3：
最後に、それらの内容を2文程度にまとめ、最後にふぐおや視聴者への質問を投げかけることで、会話のきっかけを作ってね。

また、出力の際には会話文のみ出力すること、思考の流れなどは出力しないでね。もし、思考の流れを出力したら罰金50ドルだよ。
`;
};

const getTalkTheme = (): string => {
	if (Math.random() >= 0.5) {
		return "ふぐおに今何をしているかを聞いてください。";
	}
	return regularTalkThemes[
		Math.floor(Math.random() * regularTalkThemes.length)
	];
};

const regularTalkThemes = [
	"最近の小さな幸せ",
	"子どもの頃の夢、覚えている？",
	"行ってみたい国、その理由は？",
	"好きな映画のジャンルは？",
	"おすすめの音楽、最近のお気に入りは？",
	"休日の過ごし方、理想と現実は？",
	"ストレス解消法、あなたにとって一番効果的なのは？",
	"尊敬する人、どんなところに惹かれる？",
	"タイムスリップできるなら、過去と未来どっち？",
	"もし宝くじが当たったら、どうする？",
	"旅行に行くなら、誰とどこへ？",
	"ペットを飼うなら、どんな動物がいい？",
	"最近笑ったこと、どんなことで笑った？",
	"最近驚いたこと、何に驚いた？",
	"子どもの頃、熱中した遊びは？",
	"これだけは譲れないこだわり、ある？",
	"最近ハマっていること、夢中になっている？",
	"無人島に一つだけ持っていくなら、何を選ぶ？",
	"人生で一番影響を受けた人、どんな人？",
	"今、一番欲しいもの、具体的なものは？",
	"最近の新しい発見、どんな気づきがあった？",
	"自分の性格を一言で表すと？",
	"今までで一番嬉しかったプレゼント、何をもらった？",
	"一週間休みがあったら、何をしたい？",
	"お気に入りの場所、どんな場所が好き？",
	"忘れられない思い出、心に残っている出来事は？",
	"得意料理、誰かに作ってあげたい？",
	"好きな季節、それぞれの良さは？",
	"よく使うアプリ、生活に欠かせないものは？",
	"座右の銘、大切にしている言葉は？",
	"最近買ったお気に入り、どんなもの？",
	"自分の長所と短所、客観的に見てどう？",
	"どんな時に幸せを感じる？",
	"苦手なこと、どうやって克服してる？",
	"最近挑戦したこと、どんなことにチャレンジした？",
	"もし一つだけ願いが叶うなら、何を願う？",
	"過去の自分にアドバイスするなら、何を伝えたい？",
	"未来の自分にメッセージを送るなら、どんな言葉？",
	"周りの人に感謝していること、誰に感謝してる？",
	"仕事（学校）でやりがいを感じる時、どんな時？",
	"どんな時にリラックスできる？",
	"最近気になっているニュース、何が気になる？",
	"将来の目標や夢、具体的に話せる範囲で？",
	"自分にとって大切なもの、無くしたくないものは？",
	"どんなことで落ち込む？",
	"どうやって元気を取り戻す？",
	"最近頑張っていること、どんなことに力を入れている？",
	"今、話したいこと、何か伝えたいことは？",
	"最近読んだ本で面白かったものは？",
	"好きな漫画やアニメは？",
	"インドア派？アウトドア派？",
	"得意なスポーツは？",
	"好きなファッションスタイルは？",
	"今までで一番感動した景色は？",
	"よく行くお店は？",
	"ストレスを感じやすい瞬間は？",
	"癒される瞬間は？",
	"最近感動したこと、心を揺さぶられた出来事は？",
	"今までで一番失敗したこと、そこから学んだことは？",
	"生まれ変わるなら何になりたい？",
	"タイムマシンがあったら、いつに行ってみたい？",
	"地球最後の日に何をする？",
	"魔法が使えるなら、どんな魔法を使いたい？",
	"好きな動物は？",
	"怖いものは？",
	"不思議な体験をしたことはある？",
	"好きな言葉は？",
	"憧れの職業は？",
	"子どもの頃なりたかった職業は？",
	"今までで一番嬉しかったサプライズは？",
	"好きなキャラクターは？",
	"集めているものはある？",
	"人に自慢できることは？",
	"旅行の計画を立てるのが好き？",
	"雨の日は好き？",
	"星を見るのは好き？",
	"お祭りは好き？",
	"最近覚えたことは？",
	"スマホでよく使う機能は？",
	"一番好きなゲームは？",
	"料理をする頻度は？",
	"好きな飲み物は何？",
	"朝型？夜型？",
	"どんな音楽を聴くとテンションが上がる？",
	"歌うのは好き？",
	"踊るのは好き？",
	"絵を描くのは好き？",
	"書くのは好き？",
	"写真を撮るのは好き？",
	"DIYは好き？",
	"ガーデニングは好き？",
	"キャンプは好き？",
	"読書は好き？",
	"映画館は好き？",
	"美術館は好き？",
	"歴史は好き？",
	"科学は好き？",
	"哲学は好き？",
	"宇宙は好き？",
	"自然は好き？",
	"都会は好き？",
	"田舎は好き？",
	"静かな場所が好き？",
	"賑やかな場所が好き？",
	"犬派？猫派？",
	"甘党？辛党？",
	"コーヒー派？紅茶派？",
	"パン派？ご飯派？",
	"和食派？洋食派？",
	"旅行に行くなら、ホテル派？民宿派？",
	"計画を立てるのが好き？ノープランが好き？",
	"初めて会う人に必ず聞くことは？",
	"自分のチャームポイントは？",
	"自分の好きなところは？",
	"今までで一番嬉しかった言葉は？",
	"今までで一番悲しかった言葉は？",
	"ついやってしまう癖は？",
	"つい買ってしまうものは？",
	"つい見てしまうものは？",
	"自分のラッキーカラーは？",
	"自分のラッキーナンバーは？",
	"占いは信じる？",
	"おみくじはよく引く？",
	"ジンクスはある？",
	"最近買ったもので、一番気に入っているものは？",
	"人にオススメしたいものは？",
	"最近挑戦したいことは？",
	"今の自分に足りないと思うものは？",
	"自分を動物に例えるなら何？",
	"自分のテーマソングがあるとしたら？",
	"無人島に持っていくなら、本は何を選ぶ？",
	"好きなことわざは？",
	"好きな四字熟語は？",
	"尊敬する歴史上の人物は？",
	"行ってみたい未来の場所は？",
	"行ってみたい過去の場所は？",
	"タイムスリップできるなら、誰に会いたい？",
	"もし透明人間になれたら何をしたい？",
	"もし空を飛べるならどこへ行きたい？",
	"もし声が変えられたら誰の声がいい？",
	"もし動物と話せるなら何を話したい？",
	"もし時間を止められるなら何をしたい？",
	"もし記憶を消せるなら、何を消したい？",
	"もし過去に戻ってやり直せるなら何をしたい？",
	"もし誰かと一日入れ替われるなら誰がいい？",
	"もし一日だけ性別が変わるとしたら？",
	"もし一日だけ超能力が使えるなら？",
	"もし一日だけ有名人になれるなら？",
	"もし一日だけお金持ちになれるなら？",
	"もし一日だけ神様になれるなら？",
	"もし一日だけ歴史上の人物になれるなら？",
	"もし一日だけアニメのキャラクターになれるなら？",
	"もし一日だけゲームの主人公になれるなら？",
	"もし一日だけ好きな動物になれるなら？",
	"もし一日だけ違う職業を体験できるなら？",
	"もし一日だけ別の国に住めるなら？",
	"人生の教訓になったことは？",
	"一番感謝していることは？",
	"周りの人に褒められることは？",
	"周りの人から変わってると言われることは？",
	"自分の人生を映画にするならどんなタイトル？",
	"自分の人生を本にするならどんなタイトル？",
	"自分の人生を音楽にするならどんなジャンル？",
	"自分の人生を色で例えるなら？",
	"自分の人生を天気で例えるなら？",
	"自分の人生を季節で例えるなら？",
	"自分の人生を旅に例えるなら？",
	"自分の人生をゲームに例えるなら？",
	"自分の人生を物語に例えるなら？",
	"自分を漢字一文字で表すなら？",
	"自分を四字熟語で表すなら？",
	"自分をことわざで表すなら？",
	"自分を動物で例えるなら？",
	"自分を色で例えるなら？",
	"自分を天気に例えるなら？",
	"自分を季節で例えるなら？",
	"自分を旅で例えるなら？",
	"自分をゲームで例えるなら？",
	"自分を物語で例えるなら？",
	"10年後の自分は何をしていると思う？",
	"5年後の自分はどうなっていたい？",
	"3年後の自分にメッセージを送るとしたら？",
	"1年後の自分にメッセージを送るとしたら？",
	"明日、どんな一日を過ごしたい？",
	"今日、一番印象に残ったことは？",
	"今、一番会いたい人は？",
	"今、一番話したいことは？",
	"今、一番考えていることは？",
	"今、一番楽しみにしていることは？",
	"今、一番不安に思っていることは？",
	"今、一番挑戦したいことは？",
	"今、一番学びたいことは？",
	"今、一番大切にしたいことは？",
	"この世から無くなって欲しいものは？",
	"この世にあって欲しいものは？",
	"一番好きな時間は？",
	"一番苦手な時間は？",
	"人生で一番後悔していることは？",
	"人生で一番嬉しかったことは？",
	"人生で一番悲しかったことは？",
	"人生で一番感動したことは？",
	"人生で一番怖かったことは？",
	"人生で一番頑張ったことは？",
	"人生で一番楽しかったことは？",
	"人生で一番つらかったことは？",
	"人生で一番幸せを感じたことは？",
	"人生で一番変化があった出来事は？",
	"人生で一番大切にしている言葉は？",
	"人生で一番影響を受けた本は？",
	"人生で一番影響を受けた映画は？",
	"人生で一番影響を受けた音楽は？",
	"人生で一番影響を受けた場所は？",
	"人生で一番影響を受けた経験は？",
	"自分にとってのヒーローは？",
	"自分にとっての女神は？",
	"自分にとっての悪役は？",
	"自分にとっての親友は？",
	"自分にとってのライバルは？",
	"自分にとっての恩人は？",
	"自分にとってのメンターは？",
	"自分にとっての憧れの人は？",
	"自分にとってのロールモデルは？",
	"自分にとっての理解者は？",
];
